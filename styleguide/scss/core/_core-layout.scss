//-----------------------------------------------------------------------//
// $LAYOUT
// Mixins, functions, and styles for working with units and grids.
//-----------------------------------------------------------------------//

//-----------------------------------------------------------------------//
// MIXINS AND FUNCTIONS
//-----------------------------------------------------------------------//

@mixin sf-grid-init($prefix: false) {

    @if ($prefix != false) {

        // BOUNDS CHECKING...

        @if ($highest-gutter-percentage < 0 or $highest-gutter-percentage > 100) {

            $highest-gutter-percentage: 25;
        }

        @if ($gutter-percentage-increment < 0 or $gutter-percentage-increment > 1) {

            $gutter-percentage-increment: 1;
        }

        @if ($highest-gutter-rem < 0 or $highest-gutter-rem > 100) {

            $highest-gutter-rem: 25;
        }

        @if ($gutter-rem-increment < 0 or $gutter-rem-increment > 1) {

            $gutter-rem-increment: 1;
        }

        @if ($highest-row-gutter-rem < 0 or $highest-row-gutter-rem > 100) {

            $highest-row-gutter-rem: 25;
        }

        @if ($row-gutter-rem-increment < 0 or $row-gutter-rem-increment > 1) {

            $row-gutter-rem-increment: 1;
        }

        // HANDLE GUTTER PERCENTAGES

        @if ($highest-gutter-percentage > 0) {

            @for $i from 0 through $highest-gutter-percentage {

                $f: 0;

                @while $f < 1 {

                    &[#{$prefix}gutters="#{$i + $f}%"], &[#{$prefix}gutters="#{$i + $f}"] {

                        @include sf-set-gutter (
                            $gutter: to-length($i + $f, "%")
                        );
                    }

                    $f: $f + $gutter-percentage-increment;
                }
            }
        }

        // HANDLE GUTTER REMS

        @if ($highest-gutter-rem > 0) {

            @for $i from 0 through $highest-gutter-rem {

                $f: 0;

                @while $f < 1 {

                    &[#{$prefix}gutters="#{$i + $f}rem"] {

                        @include sf-set-gutter (
                            $gutter: to-length($i + $f, "rem")
                        );
                    }

                    $f: $f + $gutter-rem-increment;
                }
            }
        }
        
        // HANDLE ROW-GUTTER REMS

        @if ($highest-row-gutter-rem > 0) {

            @for $i from 0 through $highest-row-gutter-rem {

                $f: 0;

                @while $f < 1 {

                    &[#{$prefix}row-gutters="#{$i + $f}rem"] {

                        @include sf-set-gutter (
                            $row-gutter: to-length($i + $f, "rem")
                        );
                    }

                    $f: $f + $row-gutter-rem-increment;
                }
            }
        }

        // HANDLE IMPLICIT CELL WIDTHS

        @each $increment in $grid-increments {

            &[#{$prefix}cols="#{index($grid-increments, $increment)}"] {

                & > [role="gridcell"] {

                    @include sf-set-width (
                        $width: #{$increment}
                    );

                    &[#{$prefix}#{$increment}] {

                        width: 0;
                    }
                }
            }
        }

        // HANDLE EXPLICIT CELL WIDTHS

        & > [role="gridcell"] {

            @each $frac, $widths in $grid-widths {
        
                @each $w in $widths {

                    &[#{$prefix}#{$w}] {

                        @include sf-set-width (
                            $width: $frac * 100%
                        );
                    }

                    &[#{$prefix}push-#{$w}] {

                        @include sf-push (
                            $width: $w
                        );
                    }

                    &[#{$prefix}pull-#{$w}] {

                        @include sf-pull (
                            $width: $w
                        );
                    }
                }
            }
        }
    }
}


//-----------------------------------------------------------------------//
// STYLES
//-----------------------------------------------------------------------//

html, body {

    // Needed for mobile
    overflow-x: hidden;
    max-width: 100vw;
}

body {

    // Needed for mobile
    position: relative;

    //------------------------------------//
    //  PRIMARY SITE WRAPPER
    //------------------------------------//
    header, main, footer {

        @if (nth(map-get($media-breakpoints, elastic), 1) != false) {

            max-width: $elastic-breakpoint;
        }

        margin-left: auto;
        margin-right: auto;
    }
}


/* GRID DEFAULTS

<div role="grid" sf-tabp-cols="2" sf-tabp-reverse>
    <div role="gridcell">...</div>
    <div role="gridcell">...</div>
    ...
</div>
*/

[role="grid"] {

    @include sf-flexbox-grid(
        $gridcell-width: one-whole
    );

    @each $breakpoint, $props in $media-breakpoints {

        @if (nth($props, 1) != false) {

            @if ($breakpoint == zero) {

                @include sf-grid-init("sf-");

                &[sf-reverse] {

                    flex-direction: column-reverse;
                }

                &[sf-equal-heights] {

                    @include sf-make-equal-heights();
                }

                &[sf-centered] {

                    @include sf-make-centered-grid();
                }

            } @else {

                @include sf-media($from: $breakpoint) {

                    @include sf-grid-init("sf-" + nth($props, 2) + "-");

                    &[#{"sf-" + nth($props, 2) + "-not-reverse"}] {

                        flex-direction: row;
                    }
    
                    &[#{"sf-" + nth($props, 2) + "-reverse"}] {

                        flex-direction: row-reverse;
                    }
    
                    &[sf-#{nth($props, 2)}-equal-heights] {
    
                        @include sf-make-equal-heights();
                    }
    
                    &[sf-#{nth($props, 2)}-centered] {
    
                        @include sf-make-centered-grid();
                    }
                }
            }
        }
    }

    & > [role="gridcell"] {

        &[sf-width-auto] {

            width: auto;
            flex-grow: 1;
        }
    }
}


/* UNIT STYLING
These are the outer block containers that you stack to create your UX.

<main>
    <section id="hero-unit" sf-unit>
        <div sf-outer-wrapper>
            <div sf-inner-wrapper>
                ...
                <div sf-subunit>
                    ...
                </div>
                ...
            </div>
        </div>
    </div>
    <section id="feature-unit" sf-unit>
        <div sf-outer-wrapper>
            <div sf-inner-wrapper>
                ...
            </div>
        </div>
    </div>
    ...
*/

main {

    & > [sf-unit] {

        &:not(:last-of-type) {

            @include set-bottom-unit-padding();
        }

        &, &:last-of-type {

            @include set-bottom-unit-padding();
        }

        & > div[sf-outer-wrapper] {

            margin-left: auto;
            margin-right: auto;

            @if (nth(map-get($media-breakpoints, elastic), 1) != false) {

                max-width: $elastic-breakpoint;
            }

            @include set-horizontal-unit-padding();

            & > div[sf-inner-wrapper] {

                @include set-top-unit-padding();

                & > * {

                    &:first-child {

                        margin-top: 0;
                    }
                }
            }
        }
    }

    [sf-subunit] {

        @include set-bottom-subunit-margin();

        &:last-child {

            margin-bottom: 0;
        }
    }
}
